import{S as C,i as y,s as N,d as _,q as u,a as j,r as p,u as E,w as M,x as h,y as S,z as P,A as R,B,C as D,D as O,E as q}from"./VwrJ_jBZ.js";import{I as b,g as w,a as z}from"./CQkGnOqn.js";import"./ClsFpFEz.js";import{d as l,w as A}from"./BWp1LszE.js";function k(a){let n;const r=a[2].default,t=E(r,a,a[3],null),i={c:function(){t&&t.c()},l:function(e){t&&t.l(e)},m:function(e,o){t&&t.m(e,o),n=!0},p:function(e,o){t&&t.p&&(!n||o&8)&&D(t,r,e,e[3],n?q(r,e[3],o,null):O(e[3]),null)},i:function(e){n||(S(t,e),n=!0)},o:function(e){h(t,e),n=!1},d:function(e){t&&t.d(e)}};return _("SvelteRegisterBlock",{block:i,id:k.name,type:"slot",source:'(22:0) <Icon name=\\"shopping-cart\\" {...$$props} iconNode={iconNode}>',ctx:a}),i}function m(a){let n,r;const t=[{name:"shopping-cart"},a[1],{iconNode:a[0]}];let i={$$slots:{default:[k]},$$scope:{ctx:a}};for(let e=0;e<t.length;e+=1)i=u(i,t[e]);n=new b({props:i,$$inline:!0});const c={c:function(){B(n.$$.fragment)},l:function(o){R(n.$$.fragment,o)},m:function(o,s){P(n,o,s),r=!0},p:function(o,[s]){const d=s&3?w(t,[t[0],s&2&&z(o[1]),s&1&&{iconNode:o[0]}]):{};s&8&&(d.$$scope={dirty:s,ctx:o}),n.$set(d)},i:function(o){r||(S(n.$$.fragment,o),r=!0)},o:function(o){h(n.$$.fragment,o),r=!1},d:function(o){M(n,o)}};return _("SvelteRegisterBlock",{block:c,id:m.name,type:"component",source:"",ctx:a}),c}function J(a,n,r){let{$$slots:t={},$$scope:i}=n;j("Shopping_cart",t,["default"]);const c=[["circle",{cx:"8",cy:"21",r:"1"}],["circle",{cx:"19",cy:"21",r:"1"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12"}]];return a.$$set=e=>{r(1,n=u(u({},n),p(e))),"$$scope"in e&&r(3,i=e.$$scope)},a.$capture_state=()=>({Icon:b,iconNode:c}),a.$inject_state=e=>{r(1,n=u(u({},n),e))},n&&"$$inject"in n&&a.$inject_state(n.$$inject),n=p(n),[c,n,t,i]}class Q extends C{constructor(n){super(n),y(this,n,J,m,N,{}),_("SvelteRegisterComponent",{component:this,tagName:"Shopping_cart",options:n,id:m.name})}}const I="catalogoexpress_carrito";function T(){try{const a=localStorage.getItem(I);return a?JSON.parse(a):[]}catch(a){return console.error("Error cargando carrito:",a),[]}}function F(a){try{localStorage.setItem(I,JSON.stringify(a))}catch(n){console.error("Error guardando carrito:",n)}}function G(){const{subscribe:a,set:n,update:r}=A(T());return a(t=>{F(t)}),{subscribe:a,agregarProducto:(t,i=1)=>{r(c=>{const e=c.findIndex(o=>o.id===t.id);if(e>=0){const o=[...c],s=o[e].cantidad+i,d=t.stock||o[e].stock||999;return o[e].cantidad=Math.min(s,d),o}else{const o={id:t.id,nombre:t.nombre,precio:t.precio_oferta||t.precio,precio_unitario:t.precio_oferta||t.precio,precio_original:t.precio,cantidad:Math.min(i,t.stock||999),stock:t.stock||999,imagen_url:t.imagen_url||null,marca:t.marca_nombre||t.marca||null,categoria:t.categoria_nombre||t.categoria||null,sku:t.sku||null,descripcion_larga:t.descripcion_larga||null};return[...c,o]}})},eliminarProducto:t=>{r(i=>i.filter(c=>c.id!==t))},actualizarCantidad:(t,i)=>{r(c=>i<=0?c.filter(e=>e.id!==t):c.map(e=>{if(e.id===t){const o=Math.min(i,e.stock||999);return{...e,cantidad:o}}return e}))},limpiarCarrito:()=>{n([])},obtenerProducto:t=>{let i=null;return r(c=>(i=c.find(e=>e.id===t),c)),i},verificarStock:async()=>!0}}const f=G(),H=l(f,a=>a.reduce((n,r)=>n+r.cantidad,0)),g=l(f,a=>a.reduce((n,r)=>n+r.precio_unitario*r.cantidad,0)),v=l([g],([a])=>a*.18),K=l([g,v],([a,n])=>a+n),U=l(f,a=>a.length===0);l([f,g,v,K,H],([a,n,r,t,i])=>({items:a,subtotal:n,impuesto:r,total:t,cantidadItems:i,cantidadProductos:a.length}));export{Q as S,U as a,H as b,f as c};
